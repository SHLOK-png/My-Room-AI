<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Science Exhibition Hub</title>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eef2f3; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { background: #1e3a8a; color: white; padding: 15px; text-align: center; }
        .container { display: flex; flex: 1; overflow: hidden; padding: 10px; gap: 10px; }
        
        /* Chat Box */
        .chat-box { flex: 2; background: white; display: flex; flex-direction: column; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        #chat-window { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px 15px; border-radius: 18px; max-width: 70%; word-wrap: break-word; font-size: 14px; }
        .my-msg { background: #1e3a8a; color: white; align-self: flex-end; }
        .friend-msg { background: #e5e7eb; color: #374151; align-self: flex-start; }
        
        .input-bar { pading: 15px; border-top: 1px solid #ddd; display: flex; gap: 10px; padding: 10px; }
        input[type="text"] { flex: 1; border: 1px solid #ccc; border-radius: 20px; padding: 10px 15px; outline: none; }
        button { background: #1e3a8a; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; }

        /* Sidebar */
        .sidebar { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .card { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        h3 { margin-top: 0; color: #1e3a8a; font-size: 16px; }
        #gallery img { width: 100%; border-radius: 8px; margin-top: 10px; border: 1px solid #ddd; }
    </style>
</head>
<body>

<header>
    <strong>Science Project Collaboration Hub</strong>
</header>

<div class="container">
    <div class="chat-box">
        <div id="chat-window"></div>
        <div class="input-bar">
            <input type="text" id="messageInput" placeholder="Message your partner...">
            <button onclick="publishMessage()">Send</button>
        </div>
    </div>

    <div class="sidebar">
        <div class="card">
            <h3>Shared Media</h3>
            <input type="file" id="filePicker" accept="image/*">
            <div id="gallery"></div>
        </div>
        <div class="card">
            <h3>Project To-Do</h3>
            <div style="font-size: 14px;">
                <label><input type="checkbox"> Research Model Design</label><br>
                <label><input type="checkbox"> Buy Materials</label><br>
                <label><input type="checkbox"> Final Presentation</label>
            </div>
        </div>
    </div>
</div>

<script>
    // 1. SETUP CONNECTION (Replace 'YOUR_KEY' with your actual Ably API Key)
    const ABLY_KEY = 'u5JbFg.wgSxkQ:Ih8cU_ibZpDLS5CBPm74c8U-lmgO1IVVUjkEYvyQgzg';
    const ably = new Ably.Realtime(ABLY_KEY);
    const channel = ably.channels.get('science-chat');
    const myName = "Shlok"; // You can change this to "Partner" on your friend's copy

    // 2. RECEIVE MESSAGES
    channel.subscribe('msg', (data) => {
        const chatWindow = document.getElementById('chat-window');
        const msgDiv = document.createElement('div');
        
        const isMe = data.data.user === myName;
        msgDiv.className = isMe ? 'msg my-msg' : 'msg friend-msg';
        msgDiv.innerHTML = `<strong>${data.data.user}:</strong><br>${data.data.text}`;
        
        chatWindow.appendChild(msgDiv);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    });

    // 3. SEND MESSAGES
    function publishMessage() {
        const input = document.getElementById('messageInput');
        if (input.value.trim() !== "") {
            channel.publish('msg', { user: myName, text: input.value });
            input.value = "";
        }
    }

    // 4. PREVIEW MEDIA (Local only - Cloud storage requires a paid server)
    document.getElementById('filePicker').onchange = function(e) {
        const reader = new FileReader();
        reader.onload = function() {
            const img = document.createElement('img');
            img.src = reader.result;
            document.getElementById('gallery').prepend(img);
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    // Allow 'Enter' key to send
    document.getElementById('messageInput').addEventListener("keypress", (e) => {
        if (e.key === "Enter") publishMessage();
    });
</script>

</body>
</html>